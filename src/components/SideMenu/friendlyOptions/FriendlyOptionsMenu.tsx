import React from "react";
import type {
  EntityOptionClickHandler,
  FriendlyOptionType,
} from "@/types/entities";
import {
  EntityOptionsMenu,
  type EntityOptionDefinition,
} from "../entityOptions/EntityOptionsMenu";
import { composeMapIconFromSvg } from "../entityOptions/iconComposer";

const FRIENDLY_BLUE = "#1489F9";

const getFriendlyIconElement = (type: FriendlyOptionType) => {
  switch (type) {
    case "Soldier":
      return (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clipPath="url(#friendlySoldier)">
            <path d="M20.4839 22.0778H5.47436C5.43033 22.0779 5.38675 22.0691 5.34633 22.0519C5.30592 22.0347 5.26955 22.0095 5.23948 21.9779C5.20941 21.9463 5.1863 21.9089 5.17158 21.8681C5.15687 21.8273 5.15086 21.784 5.15394 21.7408V21.0689C5.15153 20.9376 5.17574 20.8072 5.22516 20.6852C5.27457 20.5632 5.3482 20.4521 5.44176 20.3584C5.53531 20.2647 5.64692 20.1902 5.77006 20.1393C5.8932 20.0884 6.02542 20.0622 6.15899 20.0621H13.3279V16.3634L10.2732 19.3775C10.1988 19.4509 10.1104 19.5091 10.0131 19.5487C9.91574 19.5884 9.81141 19.6089 9.70604 19.6089C9.60068 19.6089 9.49635 19.5884 9.39903 19.5487C9.30171 19.5091 9.21331 19.4509 9.1389 19.3775L6.46873 16.7455C6.33079 16.6097 6.25331 16.4256 6.25331 16.2337C6.25331 16.0418 6.33079 15.8577 6.46873 15.7219L9.58321 12.6479V9.35756C9.47185 9.38536 9.3574 9.39947 9.2425 9.39955C9.17099 9.39966 9.09958 9.39439 9.02889 9.3838C8.69385 9.33415 8.38951 9.16397 8.17487 8.90626C7.96024 8.64856 7.85061 8.32169 7.86724 7.98904C7.88386 7.65638 8.02557 7.34165 8.26487 7.10587C8.50417 6.87009 8.82402 6.73006 9.1624 6.71293H9.23609C9.56172 6.71214 9.87679 6.82643 10.1238 7.03496C10.3709 7.24349 10.5334 7.53236 10.5819 7.84889C10.6101 8.03115 10.601 8.21711 10.5552 8.39587H13.8662L16.7649 5.56122C16.9028 5.42633 17.0894 5.3506 17.284 5.3506C17.4785 5.3506 17.6651 5.42633 17.8031 5.56122L20.4839 8.1901C20.6333 8.33783 20.7172 8.53769 20.7172 8.74601C20.7172 8.95433 20.6333 9.15418 20.4839 9.30191L15.3775 14.3413V20.0642H19.8142C19.9461 20.0638 20.0768 20.0891 20.1987 20.1387C20.3207 20.1882 20.4314 20.261 20.5245 20.3529C20.6199 20.4472 20.6951 20.5593 20.7458 20.6826C20.7964 20.806 20.8214 20.938 20.8193 21.071V21.7429C20.8224 21.7861 20.8163 21.8294 20.8016 21.8702C20.7869 21.911 20.7638 21.9484 20.7337 21.98C20.7037 22.0116 20.6673 22.0368 20.6269 22.054C20.5865 22.0712 20.5429 22.08 20.4989 22.0799L20.4839 22.0778ZM10.2561 11.9759L11.4929 10.7528L10.2561 9.53289V11.9759ZM10.7218 9.06674L11.9554 10.2825L13.1986 9.05939L10.7218 9.06674ZM8.74265 7.58957C8.64831 7.68376 8.58433 7.8032 8.55871 7.93295C8.53309 8.06271 8.54697 8.197 8.59862 8.31904C8.65026 8.44107 8.73737 8.54543 8.84905 8.61904C8.96073 8.69265 9.09202 8.73225 9.22648 8.73288H9.23609C9.37377 8.73099 9.50756 8.68777 9.61953 8.609C9.6384 8.5745 9.66463 8.54442 9.69643 8.52081C9.71831 8.4895 9.74625 8.46274 9.77867 8.44207C9.86365 8.33095 9.90973 8.19578 9.91004 8.05677C9.90957 7.924 9.86897 7.79436 9.79339 7.68432C9.71781 7.57428 9.61067 7.4888 9.48557 7.43873C9.36047 7.38867 9.22306 7.37628 9.09078 7.40313C8.9585 7.42999 8.83733 7.49488 8.74265 7.58957ZM6.74964 7.61792C6.69581 7.58522 6.65232 7.53843 6.62402 7.48281C6.59572 7.42718 6.58374 7.3649 6.58943 7.30296C6.58885 6.77007 6.80308 6.25867 7.18521 5.88069C7.56734 5.5027 8.08625 5.28893 8.62836 5.28615C8.69138 5.28057 8.75474 5.29234 8.81133 5.32015C8.86792 5.34797 8.91552 5.39072 8.94878 5.44363C8.98216 5.49682 8.99988 5.55806 8.99999 5.62055C9.00009 5.68304 8.98258 5.74433 8.94938 5.79763C8.91619 5.85092 8.86861 5.89413 8.81195 5.92245C8.75528 5.95078 8.69173 5.9631 8.62836 5.95807C8.26873 5.9611 7.92474 6.10309 7.67073 6.35336C7.41672 6.60363 7.27308 6.94209 7.27085 7.29561C7.27604 7.35749 7.26385 7.41959 7.2356 7.47513C7.20735 7.53067 7.16412 7.57752 7.11064 7.61057C7.0566 7.64405 6.99402 7.66181 6.93014 7.66181C6.86626 7.66181 6.80368 7.64405 6.74964 7.61057V7.61792ZM4.98199 7.20847C4.94922 7.17603 4.92404 7.13697 4.90818 7.094C4.89231 7.05104 4.88616 7.00519 4.89013 6.95965C4.89012 6.07099 5.24831 5.21852 5.88627 4.58887C6.52424 3.95921 7.39001 3.60366 8.29406 3.60005C8.33907 3.59751 8.38412 3.60433 8.42627 3.62007C8.46842 3.6358 8.50671 3.66011 8.53865 3.69139C8.57075 3.72303 8.59564 3.76101 8.61166 3.80282C8.62768 3.84464 8.63447 3.88932 8.63157 3.93391C8.63452 3.97847 8.62781 4.02313 8.61187 4.06494C8.59593 4.10675 8.57113 4.14475 8.53911 4.17642C8.50709 4.20809 8.46859 4.2327 8.42616 4.24863C8.38373 4.26457 8.33833 4.27145 8.29299 4.26882C7.56902 4.2716 6.8757 4.55639 6.36498 5.06078C5.85425 5.56517 5.56778 6.24801 5.56835 6.95965C5.57132 7.0043 5.56458 7.04905 5.54858 7.09094C5.53258 7.13282 5.50768 7.17088 5.47554 7.20257C5.44341 7.23425 5.40477 7.25885 5.36221 7.27471C5.31965 7.29057 5.27414 7.29734 5.22871 7.29456H5.21055C5.16828 7.29507 5.12632 7.28736 5.08709 7.27187C5.04786 7.25637 5.01214 7.2334 4.98199 7.20427V7.20847ZM3.27308 7.20847C3.24032 7.17603 3.21513 7.13697 3.19927 7.094C3.18341 7.05104 3.17725 7.00519 3.18123 6.95965C3.17926 6.29847 3.31006 5.64341 3.56614 5.03202C3.82221 4.42063 4.19853 3.86493 4.67351 3.39678C5.14849 2.92862 5.7128 2.55721 6.33408 2.30384C6.95537 2.05047 7.62142 1.92012 8.29406 1.92026C8.33934 1.9182 8.38455 1.92562 8.42671 1.94201C8.46886 1.9584 8.50699 1.9834 8.53859 2.01535C8.57019 2.0473 8.59453 2.08548 8.61 2.12736C8.62548 2.16925 8.63174 2.21388 8.62836 2.25832C8.63132 2.30287 8.6246 2.34753 8.60866 2.38934C8.59272 2.43115 8.56792 2.46915 8.5359 2.50082C8.50389 2.53249 8.46539 2.55711 8.42295 2.57304C8.38052 2.58897 8.33513 2.59585 8.28979 2.59323C7.70723 2.5935 7.13044 2.70673 6.59247 2.92645C6.0545 3.14616 5.5659 3.46803 5.15466 3.87363C4.74342 4.27922 4.41762 4.76058 4.19592 5.29013C3.97422 5.81968 3.86097 6.38701 3.86265 6.95965C3.86578 7.00438 3.85916 7.04925 3.84323 7.09127C3.8273 7.13328 3.80242 7.17147 3.77027 7.20327C3.73811 7.23507 3.69942 7.25976 3.65678 7.27569C3.61414 7.29161 3.56853 7.2984 3.52301 7.29561H3.50165C3.41722 7.29554 3.33623 7.26271 3.27628 7.20427L3.27308 7.20847Z" fill="white" />
          </g>
          <defs>
            <clipPath id="friendlySoldier">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>
      );
    case "Tank":
      return (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clipPath="url(#friendlyTank)">
            <path d="M8.18538 19.3451C8.18536 19.2642 8.17812 19.1835 8.16376 19.1039H12.1383C12.1239 19.1835 12.1167 19.2642 12.1167 19.3451C12.1294 19.7479 12.3055 20.1293 12.6065 20.4057C12.9074 20.6821 13.3086 20.8309 13.7219 20.8194C14.1356 20.8314 14.5374 20.6829 14.8388 20.4065C15.1402 20.13 15.3166 19.7482 15.3293 19.3451C15.3293 19.2642 15.3221 19.1835 15.3077 19.1039H16.2446C16.2303 19.1835 16.223 19.2642 16.223 19.3451C16.2357 19.748 16.412 20.1297 16.7132 20.4061C17.0144 20.6825 17.4158 20.8312 17.8293 20.8194C18.2431 20.8314 18.6448 20.6829 18.9462 20.4065C19.2476 20.13 19.4241 19.7482 19.4368 19.3451C19.4367 19.2642 19.4295 19.1835 19.4152 19.1039H20.3726V18.1561H22.08V17.3663H21.3484V11.4532L11.9357 11.4532V6.88064H14.7636V3.18007H7.93521V6.8859H10.7805L10.7805 14.2181H9.07364V15.2427H7.93521L7.93521 12.5621H3.95206L3.22048 14.2175V16.9756H1.91996V18.1598H3.22048L4.44806 19.1076H4.99215C4.97779 19.1872 4.97056 19.2679 4.97054 19.3487C4.99651 19.747 5.17716 20.1207 5.47575 20.3938C5.77435 20.6668 6.16847 20.8188 6.57796 20.8188C6.98745 20.8188 7.38157 20.6668 7.68016 20.3938C7.97876 20.1207 8.15941 19.747 8.18538 19.3487V19.3451Z" fill="white" />
          </g>
          <defs>
            <clipPath id="friendlyTank">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>
      );
    case "Radar":
      return (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clipPath="url(#friendlyRadar)">
            <path d="M19.3001 2.98292C19.6869 2.57885 20.3701 2.5756 20.826 2.97606C21.2819 3.37653 21.3378 4.02911 20.9513 4.43348L13.2316 12.5041C12.8448 12.9085 12.1616 12.9115 11.7057 12.511C11.2497 12.1104 11.1936 11.4579 11.5803 11.0536L19.3001 2.98292Z" fill="white" />
            <path d="M12 2.34009C17.5671 2.34009 22.08 6.66502 22.08 12.0001C22.08 17.3352 17.5671 21.6601 12 21.6601C6.43301 21.6601 1.92004 17.3352 1.92004 12.0001C1.92004 6.66502 6.43301 2.34009 12 2.34009ZM12 3.82624C7.28948 3.82624 3.47081 7.4858 3.47081 12.0001C3.47081 16.5144 7.28948 20.1739 12 20.1739C16.7106 20.1739 20.5293 16.5144 20.5293 12.0001C20.5293 7.4858 16.7106 3.82624 12 3.82624ZM16.1595 15.9889C16.4363 15.7225 16.8535 15.6423 17.2162 15.7858C17.5788 15.9294 17.8154 16.2683 17.8154 16.6443C17.8154 17.1558 17.3839 17.5711 16.8502 17.5732C16.4578 17.5747 16.1032 17.3494 15.9519 17.0024C15.8006 16.6555 15.8826 16.2553 16.1595 15.9889ZM12 6.79855C14.9977 6.79855 17.4277 9.12736 17.4277 12.0001C17.4277 14.8728 14.9977 17.2016 12 17.2016C9.00241 17.2016 6.57235 14.8728 6.57235 12.0001C6.57235 9.12736 9.00241 6.79855 12 6.79855ZM12 8.2847C9.85888 8.2847 8.12312 9.94814 8.12312 12.0001C8.12312 14.052 9.85888 15.7155 12 15.7155C14.1412 15.7155 15.877 14.052 15.877 12.0001C15.877 9.94814 14.1412 8.2847 12 8.2847ZM4.91186 13.7624C5.1864 13.4944 5.60165 13.4128 5.96306 13.5559C6.32448 13.6989 6.56048 14.0383 6.56051 14.415H6.57235C6.57019 14.9271 6.14017 15.3418 5.60906 15.3439C5.2184 15.3485 4.86353 15.1252 4.71069 14.7785C4.55785 14.4318 4.63732 14.0304 4.91186 13.7624ZM8.30908 5.31243C8.84282 5.30825 9.27964 5.71837 9.2862 6.22982V6.24124C9.2862 6.75423 8.85224 7.17009 8.31693 7.17009C7.78318 7.17005 7.3499 6.75649 7.34774 6.245C7.34558 5.73351 7.77535 5.31661 8.30908 5.31243Z" fill="white" />
          </g>
          <defs>
            <clipPath id="friendlyRadar">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>
      );
    case "Armor":
      return (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clipPath="url(#friendlyArmor)">
            <path d="M22.08 17.2859V18.1694H21.2036L20.3271 19.0528H19.4507C19.4507 19.5215 19.266 19.971 18.9372 20.3024C18.6084 20.6338 18.1625 20.8199 17.6975 20.8199C17.2325 20.8199 16.7866 20.6338 16.4578 20.3024C16.1291 19.971 15.9443 19.5215 15.9443 19.0528H11.9794C11.9782 19.521 11.7931 19.9698 11.4646 20.3008C11.1362 20.6319 10.691 20.8185 10.2265 20.8197C9.76167 20.8189 9.31612 20.6325 8.98732 20.3014C8.65852 19.9702 8.47324 19.5213 8.47204 19.0528H8.05423C8.05304 19.5204 7.86845 19.9686 7.54074 20.2996C7.21303 20.6306 6.76876 20.8175 6.30484 20.8197C5.84031 20.8185 5.39515 20.6319 5.06667 20.3008C4.7382 19.9698 4.55313 19.521 4.55193 19.0528H3.67296V18.1694H1.92004V17.2859H2.7965V11.1014H5.30692V8.34186H4.65172V7.70125H2.54299V8.6111H1.92004V6.259H2.54299V7.21H5.30692V4.61609H3.98997V5.53051H3.37106V3.17993H3.98997V4.13093H7.78308V3.17993H8.40652V5.52949H7.78358V4.61507H6.42278V7.21H9.08944V6.259H9.71188V8.60856H9.08894V7.70125H6.98172V8.34389H6.42177V11.1034H15.0714V15.5231H15.9443V11.9848H20.3291L21.2056 14.6351V17.2854L22.08 17.2859Z" fill="white" />
          </g>
          <defs>
            <clipPath id="friendlyArmor">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>
      );
  }
};

const friendlyOptions: FriendlyOptionType[] = ["Soldier", "Tank", "Radar", "Armor"];

const FRIENDLY_OPTION_DEFINITIONS: EntityOptionDefinition<"Friendly">[] =
  friendlyOptions.map((type) => ({
    type,
    name: type,
    color: FRIENDLY_BLUE,
    renderIcon: () => getFriendlyIconElement(type),
    createMapIconPath: (iconHost: HTMLSpanElement) => {
      const iconSvg = iconHost.querySelector("svg");
      if (!iconSvg) {
        return "";
      }
      return composeMapIconFromSvg(iconSvg, FRIENDLY_BLUE);
    },
  }));

export function FriendlyOptionsMenu({
  id,
  className,
  onOptionClick,
}: {
  id?: string;
  className?: string;
  onOptionClick?: EntityOptionClickHandler<"Friendly">;
}) {
  return (
    <EntityOptionsMenu<"Friendly">
      id={id}
      className={className}
      options={FRIENDLY_OPTION_DEFINITIONS}
      onOptionClick={onOptionClick}
    />
  );
}